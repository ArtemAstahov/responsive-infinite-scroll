"use strict";var ScrollView=Backbone.View.extend({columns:[],itemCount:-1,initialize:function(e){this.options=e.options,this.fetchColumns(),this.addMoreItems();var t=this;if(this.options.disableAutoscroll!==!0){var o=function(){$(window).scrollTop()+$(window).height()>$(document).height()-$(window).height()&&t.addMoreItems()};document.addEventListener("touchmove",o,!1),document.addEventListener("scroll",o,!1)}window.onresize=function(){this.fetchColumns()}},events:{"click .btn-more":"addMoreItems"},fetchColumns:function(){var e=this,t=$(this.options.columnsSelector+":visible");t.length<1&&jQuery.error("Columns are missing, please check the "+this.options.columnsSelector+":visible selector");var o=!1;e.columns.length!==t.length&&(e.columns=[],t.each(function(t,o){e.columns.push($(o))}),o&&e.resetItems())},resetItems:function(){this.thereAreNoMoreItems=!1,this.itemCount=-1,_.each(this.columns,function(e){e.html("")}),this.addMoreItems()},getShortenColumn:function(){for(var e=this,t=function(t){var o;return"undefined"!=typeof e.options.onCountLenght&&(o=e.options.onCountLenght(t)),"undefined"==typeof o&&(o=t.height()),o},o=this.columns[0],n=t(o),i=1;i<this.columns.length;i++){var s=this.columns[i],r=t(s);if(n>r){var o=s;n=r}}return o},gettingMore:!1,addMoreItems:function(){var e=this;this.gettingMore!==!0&&(this.gettingMore=!0,this.model.hasMore()?(this.$el.find(".btn-more, .no-more-state").hide(),this.$el.find(".load-state").show(),this.model.getMore(function(t){e.renderItems(t)})):(this.$el.find(".btn-more, .load-state").hide(),this.$el.find(".no-more-state").show()))},renderItems:function(e){var t=this,o=t.$el.find(this.options.itemTemplateSelector).html();"undefined"==typeof o&&jQuery.error("Missing pod prototype (check the itemTemplateSelector: "+this.options.itemTemplateSelector+")");var n=function(e,i){t.itemCount=t.itemCount+1;var s=i[e],r="";"string"==typeof t.options.itemClasses?r=t.options.itemClasses:"function"==typeof t.options.itemClasses&&(r=t.options.itemClasses(s));var h=_.template(o,s),l=jQuery("<div/>",{"class":r,html:h});("undefined"==typeof t.options.onAddItem||t.options.onAddItem(t.itemCount,t.getShortenColumn(),l,items[e])!==!1)&&l.appendTo(t.getShortenColumn()),e<i.length-1?setTimeout(function(){n(e+1,i)},10):(t.gettingMore=!1,t.model.hasMore()?(t.$el.find(".btn-more").show(),t.$el.find(".load-state").hide()):(t.$el.find(".load-state").hide(),t.$el.find(".no-more-state").show()))};n(0,e)}});